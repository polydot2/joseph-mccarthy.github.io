<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Network Domain and Nginx</title>
<link rel=stylesheet href=/css/style.css>
</head>
<body>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=description content>
<meta name=author content>
<title>Joe McCarthy</title>
<link rel=icon type=image/x-icon href=/favicon.ico>
<script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/js/all.min.js integrity="sha512-naukR7I+Nk6gp7p5TMA4ycgfxaZBJ7MO5iC3Fp6ySQyKFHOGfpkSZkYVWV5R7u7cfAicxanwYQ5D1e17EfJcMA==" crossorigin=anonymous referrerpolicy=no-referrer></script> <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet type=text/css>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel=stylesheet type=text/css>
<link href=/css/style.css rel=stylesheet>
<link href=/css/syntax.css rel=stylesheet>
</head>
<body id=page-top>
<nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id=mainNav>
<div class=container>
<a class=navbar-brand href=/>Joe McCarthy</a>
<button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type=button data-bs-toggle=collapse data-bs-target=#navbarResponsive aria-controls=navbarResponsive aria-expanded=false aria-label="Toggle navigation">
Menu
<em class="fas fa-bars"></em>
</button>
<div class="collapse navbar-collapse" id=navbarResponsive>
<ul class="navbar-nav ms-auto">
<li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href=https://joseph-mccarthy.github.io/posts/> Posts </a>
<li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href=https://joseph-mccarthy.github.io/projects/> Projects </a>
</ul>
</div>
</div>
</nav>
<header class="masthead2 text-white text-center"></header>
<div class="container pb-5">
<div class=row>
<section class="page-section portfolio col-12 col-lg-10">
<img class=card-img-top src=https://joseph-mccarthy.github.io/posts/network-domain-and-nginx/hero.png alt>
<h2 class="page-section-heading text-center text-uppercase text-secondary mt-5">Network Domain and Nginx</h2>
<div class="divider-custom m-0">
<div class=divider-custom-line></div>
<div class=divider-custom-icon><em class="fas fa-star"></em></div>
<div class=divider-custom-line></div>
</div>
<div class="row mb-3">
<div class="col text-center text-nowrap">
<a class=h4 href=/tags/home-lab/ title="home lab"><span class="badge bg-primary p-2 m-1">home lab</span></a>
<a class=h4 href=/tags/network/ title=network><span class="badge bg-primary p-2 m-1">network</span></a>
</div>
</div>
<div class="row justify-content-left">
<p>Today I&rsquo;ve been playing around with adding a domain name to the machines on my local network. This is with the goal of making things more formal and eventually opening up services to the internet and setting up SSL. First I thought I&rsquo;d start with a simple one which is my Raspberry Pi I used to hold data and grafanna. This is called data for the host name. To set a domain name I will be using the local DNS within <a href=https://joseph-mccarthy.github.io/posts/pi-hole/><strong>Pi-Hole</strong></a> as that&rsquo;s already on my network. The first step is to reserve the ip address for the machine. This is done through Pi-Hole as well as I actively use this as my DCHP server in order for <a href=https://joseph-mccarthy.github.io/posts/pi-hole/><strong>Pi-Hole</strong></a> to work due to limitations of my Virgin Router.</p>
<figure class=figure>
<img src=reserve-ip.png class="figure-img img-fluid rounded" alt=reserve-ip title=reserve-ip>
<figcaption class=figure-caption></figcaption>
</figure>
<p>Once the IP has been reserved for data.local I can then move on to assigning a domain to it. This will allow me to enter the full domain into a web browser and make life a lot easier when accessing applications outside of the home network eventually.</p>
<figure class=figure>
<img src=adding-domain.png class="figure-img img-fluid rounded" alt="adding a domain" title="adding a domain">
<figcaption class=figure-caption></figcaption>
</figure>
<p>This is why it was important to reserve the ip address for the machine with the hostname <strong>data</strong> as the DNS entry is marked against a perticular ip address. Therefore we don&rsquo;t want he ip address to change if <strong>data</strong> was to restart at some point. I&rsquo;m now at a point where I can get to data by entering data.joemccarthy.co.uk. However there is an annoying thing which is that I don&rsquo;t want to keep putting port numbers in everywhere. So for example on <strong>data.joemccarthy.co.uk</strong> is where I run Grafana. This runs on port 3000, and simply chaning this to port 80 is not as easy as it sounds. Also that&rsquo;s not really a solution either, as this would mean that I can only run a single application on a single machine. This isn&rsquo;t a great use of the hardware and forward thinking.</p>
<p>So to get round this I&rsquo;ll be using NGINX as a proxy. This will allow me to run multiple things on different ports while all accessing them via port 80 at <strong>data.joemccarthy.co.uk</strong>. I&rsquo;ll be using sublocations to achieve this, so the plan is to access grafana by entering <strong>data.joemccarthy.co.uk/grafana</strong>. The first step is to install nginx. Before doing that it&rsquo;s always best to do an update and upgrade</p>
<div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo apt update
sudo apt upgrade -y
</code></pre></div><p>It is extremely easy to install NGINX with the apt repository. Just run the command below and it will be ready!</p>
<div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo apt install nginx
</code></pre></div><p>Then just start it</p>
<div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>sudo /etc/init.d/nginx start
</code></pre></div><p>Once the nginx has started I head over to <strong>data.joemccarthy.co.uk</strong> to make sure that I&rsquo;m greated with the default well to nginx bluff. The next job is to go and configure the location for nginx to forward to grafana. This is done inside the configuration file containted in <strong>sites_enabled</strong></p>
<div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>location /grafana/ {
    rewrite ^/route/?(.*)$ /$1 break;
    proxy_pass  http://127.0.0.1:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }
</code></pre></div><p>Adding the above states for the given sublocation rewrite the request forwaring to same machine on port 3000 and pass along the request headers. With that being done and a quick restart of nginx I head over to <strong>data.joemccarthy.co.uk</strong> to give it a test.</p>
<figure class=figure>
<img src=grafana.png class="figure-img img-fluid rounded" alt=Configured title=Configured>
<figcaption class=figure-caption></figcaption>
</figure>
<p>Yay, it works. Going to leave it there for now.</p>
<div class="row mt-5 mb-3">
<div class="col-6 text-left">
<a class="btn btn-light btn-lg col-12 disabled" href=#><span class=h1>&#8592;</span></a>
</div>
<div class="col-6 text-right">
<a class="btn btn-primary btn-lg col-12" href=https://joseph-mccarthy.github.io/posts/python-simple-mqtt/><span class=h1>&#8594;</span></a>
</div>
</div>
</div> </section>
<section class="page-section portfolio col-12 col-lg-2 my-3">
<div id=sidebar class=fixed>
<div class="widget pt-3">
<h4 class="mb-3 widget-title">Latest Posts</h4>
<ul class=list-unstyled>
<li class="d-flex my-1">
<a href=https://joseph-mccarthy.github.io/posts/python-simple-mqtt/>
<h5>Python Simple MQTT</h5>
</a>
</li>
<li class="d-flex my-1">
<a href=https://joseph-mccarthy.github.io/posts/free-lancer-in-themes-library/>
<h5>Free Lancer in Themes Library</h5>
</a>
</li>
<li class="d-flex my-1">
<a href=https://joseph-mccarthy.github.io/posts/harlow-bindicator/>
<h5>Harlow Bindicator</h5>
</a>
</li>
</ul>
</div>
</section>
</div>
</div>
<footer class="footer text-center">
<div class=container>
<div class=row>
<div class="col-lg-4 mb-5 mb-lg-0">
<h4 class="text-uppercase mb-4">Location</h4>
<p class="lead mb-0">
Harlow, Essex
<br>
United Kingdom
</p>
</div>
<div class="col-lg-4 mb-5 mb-lg-0">
<h4 class="text-uppercase mb-4">Around the Web</h4>
<a class="btn btn-outline-light btn-social mx-1" href=https://github.com/joseph-mccarthy target=_blank><em class="fab fa-fw fa-github"></em></a>
</div>
<div class=col-lg-4>
<h4 class="text-uppercase mb-4">About Freelancer</h4>
<p class="lead mb-0">
Freelance is a free to use, MIT licensed Bootstrap theme created by
<a href=http://startbootstrap.com>Start Bootstrap</a>
</p>
</div>
</div>
</div>
</footer>
<div class="copyright py-4 text-center text-white">
<div class=container><small>Copyright &copy; Joe McCarthy 2022</small></div>
</div>
<script src=https://cdn.startbootstrap.com/sb-forms-latest.js></script>
</body>
<div class="portfolio-modal modal fade" id=modal1 tabindex=-1 aria-labelledby=modal1 aria-hidden=true>
<div class="modal-dialog modal-xl">
<div class=modal-content>
<div class="modal-header border-0"><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div>
<div class="modal-body text-center pb-5">
<div class=container>
<div class="row justify-content-center">
<div class=col-lg-8>
<h2 class="portfolio-modal-title text-secondary text-uppercase mb-0">Hugo Freelance</h2>
<div class=divider-custom>
<div class=divider-custom-line></div>
<div class=divider-custom-icon><em class="fas fa-star"></em></div>
<div class=divider-custom-line></div>
</div>
<img class="img-fluid rounded mb-5" src=/projects/hugo-freelance/hero.png alt=...>
<p class=mb-4>I wanted to use Hugo and I wanted Bootstrap Freelance. So here it is.</p>
<a href=https://joseph-mccarthy.github.io/projects/hugo-freelance/ class="btn btn-primary btn-lg col-12">Read More</a>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="portfolio-modal modal fade" id=modal2 tabindex=-1 aria-labelledby=modal2 aria-hidden=true>
<div class="modal-dialog modal-xl">
<div class=modal-content>
<div class="modal-header border-0"><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div>
<div class="modal-body text-center pb-5">
<div class=container>
<div class="row justify-content-center">
<div class=col-lg-8>
<h2 class="portfolio-modal-title text-secondary text-uppercase mb-0">Internet Monitor</h2>
<div class=divider-custom>
<div class=divider-custom-line></div>
<div class=divider-custom-icon><em class="fas fa-star"></em></div>
<div class=divider-custom-line></div>
</div>
<img class="img-fluid rounded mb-5" src=/projects/internet-monitor/hero.png alt=...>
<p class=mb-4>Small and simple application to keep my ISP honest.</p>
<a href=https://joseph-mccarthy.github.io/projects/internet-monitor/ class="btn btn-primary btn-lg col-12">Read More</a>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</html>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js integrity=sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa crossorigin=anonymous></script>
<script src=/js/scripts.js></script>
</body>
</html>
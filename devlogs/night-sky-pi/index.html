<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<title>Night Sky Pi Devlog</title>
<link rel=stylesheet href=/css/style.css>
</head>
<body>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=description content>
<meta name=author content>
<title>Joseph McCarthy</title>
<link rel=icon type=image/x-icon href=/favicon.ico>
<script src=https://use.fontawesome.com/releases/v5.15.4/js/all.js crossorigin=anonymous></script>
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet type=text/css>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel=stylesheet type=text/css>
<link href=/css/style.css rel=stylesheet>
<link href=/css/syntax.css rel=stylesheet>
</head>
<body id=page-top>
<nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id=mainNav>
<div class=container>
<a class=navbar-brand href=/>Joseph McCarthy</a>
<button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type=button data-bs-toggle=collapse data-bs-target=#navbarResponsive aria-controls=navbarResponsive aria-expanded=false aria-label="Toggle navigation">
Menu
<i class="fas fa-bars"></i>
</button>
<div class="collapse navbar-collapse" id=navbarResponsive>
<ul class="navbar-nav ms-auto">
<li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href=https://joseph-mccarthy.github.io/devlogs/> Devlogs </a>
<li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href=https://joseph-mccarthy.github.io/posts/> Posts </a>
<li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href=https://joseph-mccarthy.github.io/projects/> Projects </a>
</ul>
</div>
</div>
</nav>
<header class="masthead2 text-white text-center"></header>
<div class="container pb-5">
<div class=row>
<section class="page-section portfolio col-12 col-lg-10">
<img class=card-img-top src=https://joseph-mccarthy.github.io/devlogs/night-sky-pi/hero.png alt>
<h2 class="page-section-heading text-center text-uppercase text-secondary mt-5">Night Sky Pi Devlog</h2>
<div class="divider-custom m-0">
<div class=divider-custom-line></div>
<div class=divider-custom-icon><i class="fas fa-star"></i></div>
<div class=divider-custom-line></div>
</div>
<div class="row mb-3">
<div class="col text-center text-nowrap">
<a class=h4 href=/tags/developer-log/ title="Developer Log"><span class="badge bg-primary p-2 m-1">Developer Log</span></a>
<a class=h4 href=/tags/project/ title=Project><span class="badge bg-primary p-2 m-1">Project</span></a>
<a class=h4 href=/tags/rasberry-pi/ title="Rasberry Pi"><span class="badge bg-primary p-2 m-1">Rasberry Pi</span></a>
</div>
</div>
<div class="row justify-content-left">
<div class="text-center m-2">
<p><img src="https://img.shields.io/github/workflow/status/joseph-mccarthy/night-sky-pi/Build?style=for-the-badge" alt="GitHub Workflow Status">
<img src="https://img.shields.io/codecov/c/gh/joseph-mccarthy/night-sky-pi?style=for-the-badge" alt=Codecov>
<img src="https://img.shields.io/sonar/quality_gate/joseph-mccarthy_night-sky-pi/main?server=https%3A%2F%2Fsonarcloud.io&style=for-the-badge" alt="Sonar Quality Gate">
<img src="https://img.shields.io/github/license/joseph-mccarthy/night-sky-pi?style=for-the-badge" alt=GitHub>
<img src="https://wakatime.com/badge/github/joseph-mccarthy/night-sky-pi.svg?style=for-the-badge" alt=wakatime></p>
</div>
<p>So I now have myself a Raspberry Zero 2W. This means I can now begin a project that I have been holding off for a while, which is my night sky pi. The princple of the project is rather straight forward I want a device that I can place outside which will just look up.</p>
<p>During the night it will record the sky not sure if it&rsquo;s going to be pictures or video. Then during the day it will process those images or video to try and detect and meteors or other objects. I&rsquo;m expecting a lot of planes while I tweak the code.</p>
<p>I&rsquo;m trying to make it as lightweight as possible due to the hardware, so only time will tell if I&rsquo;ll be able to process the images on this device or if they will have to be offloaded to another device for processing. You can find the source code on <a href=https://github.com/joseph-mccarthy/night-sky-pi>GitHub</a></p>
<hr>
<h2 id=28032022>28/03/2022</h2>
<p>So making a start on the project like all the others start with an empty repository. Have decided to write this with Python because it&rsquo;s lightweight for the hardware, and there is a standard library for the Pi camera, which I still need to look into.</p>
<p>But before any code can be written I needed to build the pi and load an OS. This was simple, just standard 32bit lite OS, and the Zero snapped into it&rsquo;s case with the camera hole nicely aligned after changing the ribbon cable for the shorter version which came with the case. Once that was completed it was time to boot it up and give it the general once over and update everything.</p>
<p>I also took this time to update the version of python installed to 3.10.3 which I&rsquo;ll be using the application. Another thing was installing git, because this will allow me to quickly pull changes down to the device for testing. Once the application is completed I&rsquo;ll be researching a more formal way to distribute it.</p>
<p>Now for some development, first thing first is setting up the readme file, then the requirements.txt. Then the creating of the main module entry point. Simple enough. So there are a few things I need to do, which I&rsquo;m going to call the loop! This loop will get the current datetime, then for a given date, along with a coordinate it will then get the sunrise and sunset. This is to work out where we are in the cycle. So do we need to capture images or process images and wait for sunset. There is a an edge case to this which is the current datetime could be the next day, however we are still in the preious night. For example, it could be 2am which is before sunrise and sunset for that given datetime, however really we are on the pervious cycle.</p>
<p>So we need to check the datetime being after the sunset and before the next day sunrise. If this is the case then we capture images, however we also need to check if this false, then check if the datetime is between yesterday sunset and todays sunrise, which would be true if the time was past 00:00. If neither of the above are true, then it can be certain that we are between the sunrise and sunset of the current datetime, and we should either be processing images or waiting for sunset.</p>
<hr>
<h2 id=29032022>29/03/2022</h2>
<p>Today has been a rather productive day in my eyes. I haven&rsquo;t done much code, but spent some time doing all the admin stuff around the project. So the progress today has been setting up a unit test, which at the moment tests nothing. But this test was needed to set up a github action to build the code base and run tests.</p>
<p>The next step was to set up codecov and sonar cloud for the project, then modify the action to provide code coverage, which at this point is zero, and also send violations and quality metrics to sonar cloud.</p>
<p>With these completed I was then able to do the all important adding of badges to the readme file. So now at a glace I can see the build, coverage, quality gate and the important licence information MIT what else.</p>
<p>Aswell as some of the admin and code quality work I did manage to get some coding done. I created some functions for dates, rather simple, just getting today, previous and next. This are simple to do inline, however it&rsquo;s just my preference to split these out into methods and place them in a module. The next thing I done was create a module to get sunrise and sunset data. I found a great module to do this for me called <strong>suntime</strong>.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#007020;font-weight:700>def</span> <span style=color:#06287e>get_rise_and_set</span>(date: datetime, coorindates: <span style=color:#007020>tuple</span>()) <span style=color:#666>-&gt;</span> <span style=color:#007020>tuple</span>():
    latitude, longitude <span style=color:#666>=</span> coorindates
    sun <span style=color:#666>=</span> Sun(latitude, longitude)
    sr <span style=color:#666>=</span> sun<span style=color:#666>.</span>get_sunrise_time(date)<span style=color:#666>.</span>replace(tzinfo<span style=color:#666>=</span><span style=color:#007020;font-weight:700>None</span>)
    ss <span style=color:#666>=</span> sun<span style=color:#666>.</span>get_sunset_time(date)<span style=color:#666>.</span>replace(tzinfo<span style=color:#666>=</span><span style=color:#007020;font-weight:700>None</span>)
    <span style=color:#007020;font-weight:700>return</span> (sr, ss)
</code></pre></div><p>All it requires is the latitude, longitude and a datetime, then it&rsquo;s able to return the datetime of the sunrise and sunset. I was thinking of using a rest api to get this information for me, however this is a nicer solution in my eyes. So I imported this module and wrapped it within my own sun module. The only modification I done to the datetime returned is to remove the timezone information as this is something I&rsquo;m not interested in and allows me to compare the datetimes returned here with those from my datetime functions.</p>
<p>Lastly I adding some command line arguements to the program so I was able to provide information here rather than looking into configuration files at the moment.</p>
<div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>parser <span style=color:#666>=</span> argparse<span style=color:#666>.</span>ArgumentParser()
parser<span style=color:#666>.</span>add_argument(<span style=color:#4070a0>&#34;--lat&#34;</span>,<span style=color:#007020>type</span><span style=color:#666>=</span><span style=color:#007020>float</span>,required<span style=color:#666>=</span><span style=color:#007020;font-weight:700>True</span>,help<span style=color:#666>=</span><span style=color:#4070a0>&#34;Latitude&#34;</span>)
parser<span style=color:#666>.</span>add_argument(<span style=color:#4070a0>&#34;--lon&#34;</span>,<span style=color:#007020>type</span><span style=color:#666>=</span><span style=color:#007020>float</span>,required<span style=color:#666>=</span><span style=color:#007020;font-weight:700>True</span>,help<span style=color:#666>=</span><span style=color:#4070a0>&#34;Longitude&#34;</span>)
parser<span style=color:#666>.</span>add_argument(<span style=color:#4070a0>&#34;--log&#34;</span>,<span style=color:#007020>type</span><span style=color:#666>=</span><span style=color:#007020>str</span>,help<span style=color:#666>=</span><span style=color:#4070a0>&#34;Level&#34;</span>,default<span style=color:#666>=</span>logging<span style=color:#666>.</span>WARNING)
args <span style=color:#666>=</span> parser<span style=color:#666>.</span>parse_args()
</code></pre></div><p>The arguements being passed is the latitude and longitude of the camera, which are required for this program to execute. Then an optional debug level, which defaults to <strong>WARNING</strong>, this just allows me to quickly debug the application while I develop it.</p>
<hr>
<div class="row mt-5 mb-3">
<div class="col-6 text-left">
<a class="btn btn-light btn-lg col-12 disabled" href=#><span class=h1>&#8592;</span></a>
</div>
<div class="col-6 text-right">
<a class="btn btn-light disabled btn-lg col-12" href=#><span class=h1>&#8594;</span></a>
</div>
</div>
</div> </section>
<section class="page-section portfolio col-12 col-lg-2 my-3">
<div id=sidebar class=fixed>
<div class="widget pt-3">
<h4 class="mb-3 widget-title">Latest Posts</h4>
<ul class=list-unstyled>
<li class="d-flex my-1">
<a href=https://joseph-mccarthy.github.io/posts/github-sponsers/>
<h5>Github Sponsers</h5>
</a>
</li>
<li class="d-flex my-1">
<a href=https://joseph-mccarthy.github.io/posts/pi-pick-up/>
<h5>Pi Pick Up</h5>
</a>
</li>
<li class="d-flex my-1">
<a href=https://joseph-mccarthy.github.io/posts/pi-hole/>
<h5>Pi-hole</h5>
</a>
</li>
</ul>
</div>
<div class="widget pt-3">
<h4 class="mb-3 widget-title">Related Posts</h4>
<ul class=list-unstyled>
<li class="d-flex my-1">
<a href=https://joseph-mccarthy.github.io/posts/pi-pick-up/>
<h5>Pi Pick Up</h5>
</a>
</li>
<li class="d-flex my-1">
<a href=https://joseph-mccarthy.github.io/posts/pi-hole/>
<h5>Pi-hole</h5>
</a>
</li>
<li class="d-flex my-1">
<a href=https://joseph-mccarthy.github.io/posts/second-project-released/>
<h5>Second Project Released</h5>
</a>
</li>
</ul>
</div>
</div>
</section>
</div>
</div>
<footer class="footer text-center">
<div class=container>
<div class=row>
<div class="col-lg-4 mb-5 mb-lg-0">
<h4 class="text-uppercase mb-4">Location</h4>
<p class="lead mb-0">
Harlow, Essex
<br>
United Kingdom
</p>
</div>
<div class="col-lg-4 mb-5 mb-lg-0">
<h4 class="text-uppercase mb-4">Around the Web</h4>
<a class="btn btn-outline-light btn-social mx-1" href=https://github.com/joseph-mccarthy target=_blank><i class="fab fa-fw fa-github"></i></a>
</div>
<div class=col-lg-4>
<h4 class="text-uppercase mb-4">About Freelancer</h4>
<p class="lead mb-0">
Freelance is a free to use, MIT licensed Bootstrap theme created by
<a href=http://startbootstrap.com>Start Bootstrap</a>
.
</p>
</div>
</div>
</div>
</footer>
<div class="copyright py-4 text-center text-white">
<div class=container><small>Copyright &copy; Joseph McCarthy 2022</small></div>
</div>
<script src=https://cdn.startbootstrap.com/sb-forms-latest.js></script>
</body>
}
<div class="portfolio-modal modal fade" id=modal1 tabindex=-1 aria-labelledby=modal1 aria-hidden=true>
<div class="modal-dialog modal-xl">
<div class=modal-content>
<div class="modal-header border-0"><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div>
<div class="modal-body text-center pb-5">
<div class=container>
<div class="row justify-content-center">
<div class=col-lg-8>
<h2 class="portfolio-modal-title text-secondary text-uppercase mb-0">Hugo Freelance</h2>
<div class=divider-custom>
<div class=divider-custom-line></div>
<div class=divider-custom-icon><i class="fas fa-star"></i></div>
<div class=divider-custom-line></div>
</div>
<img class="img-fluid rounded mb-5" src=/projects/hugo-freelance/hero.png alt=...>
<p class=mb-4>I wanted to use Hugo and I wanted Bootstrap Freelance. So here it is.</p>
<a href=/projects/hugo-freelance/ class="btn btn-primary btn-lg col-12">Read More</a>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="portfolio-modal modal fade" id=modal2 tabindex=-1 aria-labelledby=modal2 aria-hidden=true>
<div class="modal-dialog modal-xl">
<div class=modal-content>
<div class="modal-header border-0"><button class=btn-close type=button data-bs-dismiss=modal aria-label=Close></button></div>
<div class="modal-body text-center pb-5">
<div class=container>
<div class="row justify-content-center">
<div class=col-lg-8>
<h2 class="portfolio-modal-title text-secondary text-uppercase mb-0">Internet Monitor</h2>
<div class=divider-custom>
<div class=divider-custom-line></div>
<div class=divider-custom-icon><i class="fas fa-star"></i></div>
<div class=divider-custom-line></div>
</div>
<img class="img-fluid rounded mb-5" src=/projects/internet-monitor/hero.png alt=...>
<p class=mb-4>Small and simple application to keep my ISP honest.</p>
<a href=/projects/internet-monitor/ class="btn btn-primary btn-lg col-12">Read More</a>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</html>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js></script>
<script src=/js/scripts.js></script>
</body>
</html>